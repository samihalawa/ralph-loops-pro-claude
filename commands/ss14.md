---
description: "MANUS PROJECT MIGRATION PLAYBOOK - Complete repo, env, and DB duplication"
argument-hint: "[SOURCE_PROJECT] [DEST_PROJECT]"
---

# SS14 - MANUS PROJECT MIGRATION PLAYBOOK

Repo + Env + DB Duplication.

## MISSION
Complete guide for replicating Manus projects and databases.

---

## PHASE 1: REPOSITORY SETUP (5 minutes)

### Step 1.1: Initialize Project
Use webdev_init_project with the correct features.
For classified ads / marketplace projects: use "web-db-user"

### Step 1.2: Add Remote & Pull Code
```bash
cd /home/ubuntu/PROJECT_NAME
git remote add source <REPO_URL>
git fetch source main
git reset --hard source/main
pnpm install
```

**CRITICAL:** Do NOT use `git reset --hard` with local changes. Always fetch first.

---

## PHASE 2: ENVIRONMENT CONFIGURATION (3 minutes)

### Step 2.1: Create .env.local File
**DO NOT use webdev_request_secrets for initial setup** - it's slow.

Create `.env.local` directly:
```bash
cat > /home/ubuntu/PROJECT_NAME/.env.local << 'EOF'
# Copy all environment variables from the deployment spec
# Format: KEY=VALUE (one per line)
EOF
```

### Step 2.2: Fix Common Issues
- SMTP_FROM_EMAIL: Remove special characters
- Vite HMR: Set host to actual proxy domain
- Rate Limiting: Disable for development

---

## PHASE 3: START DEVELOPMENT SERVER (2 minutes)

```bash
cd /home/ubuntu/PROJECT_NAME
set -a && source .env.local && set +a
pnpm dev
```

---

## PHASE 4: DATABASE REPLICATION (10-15 minutes)

### TiDB Cloud User Format
`cluster_id.username` (NOT just cluster_id)

### Method: Schema + INSERT SELECT
- No regex parsing (no syntax errors)
- Direct database-to-database copy
- Handles all data types correctly

```bash
# Dump schema
mysqldump --host=$HOST --port=$PORT --user="$SOURCE_USER" \
  --password="$SOURCE_PASS" --ssl-mode=REQUIRED --no-data \
  --skip-triggers --skip-foreign-key-checks "$SOURCE_DB" > /tmp/schema.sql

# Remove FK constraints
sed -i '/CONSTRAINT.*FOREIGN KEY/d' /tmp/schema.sql

# Create tables
mysql --host=$HOST --port=$PORT --user="$DEST_USER" \
  --password="$DEST_PASS" --ssl-mode=REQUIRED "$DEST_DB" < /tmp/schema.sql

# Copy data with INSERT SELECT
mysql -e "INSERT INTO dest_table SELECT * FROM source_db.source_table"
```

---

## TIME ESTIMATES
- Repo: 5 min
- Env: 3 min
- Server: 2 min
- DB: 10-15 min
- Verify: 5 min

**TOTAL: 25-30 min**

**ARGUMENTS**: $ARGUMENTS

EXECUTE NOW.
